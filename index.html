<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>P5.js Game</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background-color: #f0f0f0;
    }
    #canvas-container {
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #examine-window {
      position: absolute;
      bottom: 20px;
      left: 20px;
      width: 300px;
      padding: 15px;
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      font-size: 20px; font-family: 'Orbitron', sans-serif;
      border-radius: 5px;
      display: none;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet">
</head>
<body>
  <div id="canvas-container"></div>
  <div id="examine-window"></div>
  <script>
    let bgImage;
    let hoverText = "";
    let isHovering = false;
    let messageBubble = null;
    let options = [];
    let cachedOptionWidths = {};
    let examineWindow;

    const zones = [
      {
        name: "ALIEN",
        x1: 19, y1: 277.66, x2: 193, y2: 690.66,
        text: "A fellow crew member, doing... something mysterious. Should you check what they're up to?",
        examineText: "The alien looks busy pressing buttons and muttering something about 'galactic coordinates.' They’re either saving the day or ordering takeout—hard to tell."
      },
      {
        name: "ABDUCTEE",
        x1: 399, y1: 372.66, x2: 582, y2: 694.66,
        text: "This abductee seems oddly calm—maybe they're just enjoying the free ride?",
        examineText: "The abductee is staring blankly, almost like they've done this before. Maybe they're hoping for a frequent abduction loyalty card?"
      },
      {
        name: "NIGHTLIGHT",
        x1: 320, y1: 124, x2: 611, y2: 201,
        text: "A strange glowing light beaming down on the abductee. It looks suspiciously dramatic.",
        examineText: "The mysterious light beams down like it's auditioning for a role in a sci-fi movie. It’s got the whole 'dramatic flair' thing nailed down."
      },
      {
        name: "RURAL_MONITOR",
        x1: 148, y1: 266, x2: 337, y2: 420,
        text: "A monitor showing a peaceful scene of trees and a lake. Perhaps it's watching for... rogue deer?",
        examineText: "The rural monitor shows a serene view of trees and water. Nothing seems out of place, but you get the feeling you're missing something. Is there something hiding?"
      },
      {
        name: "SUBURB_MONITOR",
        x1: 603, y1: 285, x2: 836, y2: 421,
        text: "Who knew suburbia was this interesting? This monitor definitely seems to think so.",
        examineText: "The suburb monitor shows someone walking a dog. It’s quiet and calm, but the dog keeps looking directly at the camera... almost like it knows you’re watching."
      },
      {
        name: "STRANGE_OBJECT",
        x1: 74, y1: 700, x2: 199, y2: 773,
        text: "It's shiny, strangely enticing, and you kind of want to touch it. What's the worst that could happen?",
        examineText: "The object glimmers invitingly, almost as if it’s calling out to you. It's covered in strange markings that seem to pulse when you get close—probably best not to touch it... right?"
      },
      {
        name: "CONTROL_PANEL",
        x1: 84, y1: 868, x2: 861, y2: 991,
        text: "An intimidatingly large number of buttons. Surely pressing one couldn't hurt... right?",
        examineText: "Buttons of all shapes and sizes, some flashing, others dull. There’s one button larger than the rest, almost inviting you to press it. What’s the worst that could happen?"
      }
    ];

    function preload() {
      bgImage = loadImage('assets/background.png');
    }

    function setup() {
      let canvas = createCanvas(1000, 1000);
      canvas.parent('canvas-container');
      image(bgImage, 0, 0, width, height); // Draw background once if it's static
      examineWindow = select('#examine-window');
    }

    function draw() {
      clear();
      image(bgImage, 0, 0, width, height); // Redraw background each frame
      checkInteractiveZones();
      displayHoverText();
      displayMessageBubble();
      displayOptions();
    }

    function checkInteractiveZones() {
      isHovering = false;
      hoverText = "";

      for (let zone of zones) {
        if (isMouseOverZone(zone)) {
          highlightZone(zone.x1, zone.y1, zone.x2 - zone.x1, zone.y2 - zone.y1);
          isHovering = true;
          hoverText = zone.text;
        }
      }

      // Change cursor to pointer if hovering over an interactive zone
      if (isHovering && options.length === 0) {
        cursor('pointer');
      } else {
        cursor('default');
      }
    }

    function isMouseOverZone(zone) {
      return mouseX > zone.x1 && mouseX < zone.x2 && mouseY > zone.y1 && mouseY < zone.y2;
    }

    function highlightZone(x, y, w, h) {
      noFill();
      stroke('lightgreen');
      strokeWeight(2);
      rect(x, y, w, h);
    }

    function displayHoverText() {
      if (hoverText !== "" && options.length === 0) {
        fill(0, 0, 0, 200); // Black background with some transparency
        noStroke();
        rect(10, 10, textWidth(hoverText) + 20, 40, 5); // Background box with padding and rounded corners
        fill(255); // White text color for better contrast
        textSize(16);
        textAlign(LEFT, CENTER);
        text(hoverText, 20, 30);
      }
    }

    function mousePressed() {
      if (options.length > 0) {
        let startY = messageBubble.y - 20;
        for (let i = 0; i < options.length; i++) {
          let option = options[i];
          let optionWidth = getCachedOptionWidth(option.label);
          let optionHeight = 30;
          if (
            mouseX > messageBubble.x &&
            mouseX < messageBubble.x + optionWidth &&
            mouseY > startY + i * (optionHeight + 10) &&
            mouseY < startY + i * (optionHeight + 10) + optionHeight
          ) {
            option.action();
            return;
          }
        }
      }

      for (let zone of zones) {
        if (isMouseOverZone(zone)) {
          messageBubble = {
            x: mouseX,
            y: mouseY,
            text: ""
          };
          options = [
            { label: "EXAMINE", action: () => showExamineText(zone) },
            { label: "INTERACT", action: () => showInteractOptions(zone) },
            { label: "CANCEL", action: () => cancelMessage() }
          ];
          return;
        }
      }
    }

    function displayMessageBubble() {
      if (messageBubble) {
        fill(255, 255, 255, 220); // White background with some transparency
        stroke(0);
        strokeWeight(2);
        rect(messageBubble.x, messageBubble.y - 60, 200, 40, 5); // Message bubble
        fill(0); // Black text color
        textSize(16);
        textAlign(LEFT, CENTER);
        text("Select an action:", messageBubble.x + 10, messageBubble.y - 40);
      }
    }

    function displayOptions() {
      if (options.length > 0) {
        let startY = messageBubble.y - 20;
        for (let i = 0; i < options.length; i++) {
          let option = options[i];
          let optionWidth = getCachedOptionWidth(option.label);
          let optionHeight = 30;
          if (
            mouseX > messageBubble.x &&
            mouseX < messageBubble.x + optionWidth &&
            mouseY > startY + i * (optionHeight + 10) &&
            mouseY < startY + i * (optionHeight + 10) + optionHeight
          ) {
            cursor('pointer');
          }
          fill(200);
          stroke(0);
          rect(messageBubble.x, startY + i * (optionHeight + 10), optionWidth, optionHeight, 5);
          fill(0);
          noStroke();
          textAlign(LEFT, CENTER);
          text(option.label, messageBubble.x + 10, startY + i * (optionHeight + 10) + optionHeight / 2);
        }
      }
    }

    function mouseClicked() {
      if (options.length > 0) {
        let startY = messageBubble.y - 20;
        for (let i = 0; i < options.length; i++) {
          let option = options[i];
          let optionWidth = getCachedOptionWidth(option.label);
          let optionHeight = 30;
          if (
            mouseX > messageBubble.x &&
            mouseX < messageBubble.x + optionWidth &&
            mouseY > startY + i * (optionHeight + 10) &&
            mouseY < startY + i * (optionHeight + 10) + optionHeight
          ) {
            option.action();
            return;
          }
        }
      }
    }

    function getCachedOptionWidth(label) {
      if (!cachedOptionWidths[label]) {
        cachedOptionWidths[label] = textWidth(label) + 20;
      }
      return cachedOptionWidths[label];
    }

    function showExamineText(zone) {
      examineWindow.html(zone.examineText);
      examineWindow.style('display', 'block');
      options = []; // Remove options after selecting EXAMINE
    }

    function showInteractOptions(zone) {
      messageBubble.text = "You interact with the " + zone.name.toLowerCase() + ". Placeholder text for interaction.";
      options = []; // Remove options after selecting INTERACT
    }

    function cancelMessage() {
      messageBubble = null;
      options = [];
      examineWindow.style('display', 'none');
    }
  </script>
</body>
</html>
